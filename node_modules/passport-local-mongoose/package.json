{
  "_from": "passport-local-mongoose",
  "_id": "passport-local-mongoose@5.0.1",
  "_inBundle": false,
  "_integrity": "sha512-VUY5DgBdpjt1tjunJJ1EXV5b2nhMDkXJuhTjyiK660IgIp7kONMyWEe9tGHf8I9tZudXuTF+47JNQLIzU+Hjbw==",
  "_location": "/passport-local-mongoose",
  "_phantomChildren": {},
  "_requested": {
    "escapedName": "passport-local-mongoose",
    "fetchSpec": "latest",
    "name": "passport-local-mongoose",
    "raw": "passport-local-mongoose",
    "rawSpec": "",
    "registry": true,
    "saveSpec": null,
    "type": "tag"
  },
  "_requiredBy": [
    "#USER",
    "/"
  ],
  "_resolved": "https://registry.npmjs.org/passport-local-mongoose/-/passport-local-mongoose-5.0.1.tgz",
  "_shasum": "7b45ae6bcb6e8a7be26a4a95a7787e4d14130fc7",
  "_spec": "passport-local-mongoose",
  "_where": "F:\\Git\\Project-X",
  "author": {
    "email": "christoph.walcher@gmail.com",
    "name": "Christoph Walcher"
  },
  "bugs": {
    "url": "https://github.com/saintedlama/passport-local-mongoose/issues"
  },
  "bundleDependencies": false,
  "dependencies": {
    "debug": "^3.1.0",
    "generaterr": "^1.5.0",
    "passport-local": "^1.0.0",
    "scmp": "^2.0.0",
    "semver": "^5.5.0"
  },
  "deprecated": false,
  "description": "Mongoose plugin that simplifies building username and password login with Passport",
  "devDependencies": {
    "babel-polyfill": "^6.26.0",
    "babel-preset-env": "^1.7.0",
    "babel-register": "^6.26.0",
    "chai": "^4.1.2",
    "coveralls": "^3.0.1",
    "cross-env": "^5.2.0",
    "drop-mongodb-collections": "^1.2.2",
    "eslint": "^4.19.1",
    "mocha": "^5.2.0",
    "mocha-lcov-reporter": "^1.3.0",
    "mongoose": "^5.1.6",
    "nyc": "^12.0.2",
    "standard-version": "^4.4.0"
  },
  "engines": {
    "node": ">= 6.0.0"
  },
  "homepage": "https://github.com/saintedlama/passport-local-mongoose#readme",
  "keywords": [
    "authentication",
    "login",
    "mongoose",
    "passport"
  ],
  "license": "MIT",
  "main": "index.js",
  "name": "passport-local-mongoose",
  "optionalDependencies": {},
  "readme": "# Passport-Local Mongoose\r\n\r\nPassport-Local Mongoose is a [Mongoose](http://mongoosejs.com/) [plugin](http://mongoosejs.com/docs/plugins.html)\r\nthat simplifies building username and password login with [Passport](http://passportjs.org).\r\n\r\n[![Build Status](https://travis-ci.org/saintedlama/passport-local-mongoose.png?branch=master)](https://travis-ci.org/saintedlama/passport-local-mongoose)\r\n[![Coverage Status](https://coveralls.io/repos/saintedlama/passport-local-mongoose/badge.png?branch=master)](https://coveralls.io/r/saintedlama/passport-local-mongoose?branch=master)\r\n[![passport-local-mongoose analyzed by Codellama.io](https://app.codellama.io/api/badges/5a04399c1b4c363a0f9427f8/fcac8d5ab6ca708f09999469b02890ce)](https://app.codellama.io/repositories/5a04399c1b4c363a0f9427f8)\r\n\r\n## Tutorials\r\n\r\nMichael Herman gives a comprehensible walk through for setting up mongoose,\r\npassport, passport-local and passport-local-mongoose for user authentication in his blog post [User Authentication With Passport.js](http://mherman.org/blog/2013/11/11/user-authentication-with-passport-dot-js/)\r\n\r\n## Installation\r\n\r\n```bash\r\n> npm install passport-local-mongoose\r\n```\r\n\r\nPassport-Local Mongoose does not require `passport`, `passport-local` or `mongoose` dependencies directly but expects you\r\nto have these dependencies installed.\r\n\r\nIn case you need to install the whole set of dependencies\r\n\r\n```bash\r\n> npm install passport passport-local mongoose passport-local-mongoose --save\r\n```\r\n\r\n### Updating from 1.x to 2.x\r\n\r\nThe default digest algorithm was changed due to security implications from **sha1** to **sha256**. If you decide to upgrade a production system from 1.x to 2.x your users **will not be able to login** since the digest algorithm was changed! In these cases plan some migration strategy and/or use the **sha1** option for the digest algorithm.\r\n\r\n## Usage\r\n\r\n### Plugin Passport-Local Mongoose\r\n\r\nFirst you need to plugin Passport-Local Mongoose into your User schema\r\n\r\n```javascript\r\nconst mongoose = require('mongoose');\r\nconst Schema = mongoose.Schema;\r\nconst passportLocalMongoose = require('passport-local-mongoose');\r\n\r\nconst User = new Schema({});\r\n\r\nUser.plugin(passportLocalMongoose);\r\n\r\nmodule.exports = mongoose.model('User', User);\r\n```\r\n\r\nYou're free to define your User how you like. Passport-Local Mongoose will add a username, hash and salt field to store the username, the hashed password and the salt value.\r\n\r\nAdditionally Passport-Local Mongoose adds some methods to your Schema. See the API Documentation section for more details.\r\n\r\n### Configure Passport/Passport-Local\r\n\r\nYou should configure Passport/Passport-Local as described in [the Passport Guide](http://passportjs.org/guide/configure/).\r\n\r\nPassport-Local Mongoose supports this setup by implementing a `LocalStrategy` and serializeUser/deserializeUser functions.\r\n\r\nTo setup Passport-Local Mongoose use this code\r\n\r\n```javascript\r\n// requires the model with Passport-Local Mongoose plugged in\r\nconst User = require('./models/user');\r\n\r\n// use static authenticate method of model in LocalStrategy\r\npassport.use(new LocalStrategy(User.authenticate()));\r\n\r\n// use static serialize and deserialize of model for passport session support\r\npassport.serializeUser(User.serializeUser());\r\npassport.deserializeUser(User.deserializeUser());\r\n```\r\n\r\nMake sure that you have a mongoose connected to mongodb and you're done.\r\n\r\n#### Simplified Passport/Passport-Local Configuration\r\n\r\nStarting with version 0.2.1 passport-local-mongoose adds a helper method `createStrategy` as static method to your schema.\r\nThe `createStrategy` is responsible to setup passport-local `LocalStrategy` with the correct options.\r\n\r\n```javascript\r\nconst User = require('./models/user');\r\n\r\n// CHANGE: USE \"createStrategy\" INSTEAD OF \"authenticate\"\r\npassport.use(User.createStrategy());\r\n\r\npassport.serializeUser(User.serializeUser());\r\npassport.deserializeUser(User.deserializeUser());\r\n```\r\n\r\nThe reason for this functionality is that when using the `usernameField` option to specify an alternative usernameField name, for example \"email\" passport-local would still expect your frontend login form to contain an input field with name \"username\" instead of email. This can be configured for passport-local but this is double the work. So we got this shortcut implemented.\r\n\r\n### Async/Await\r\n\r\nStarting with version `5.0.0` passport-local-mongoose is async/await enabled by returning\r\nPromises for all instance and static methods except `serializeUser` and `deserializeUser`.\r\n\r\n```js\r\nconst user = new DefaultUser({username: 'user'});\r\nawait user.setPassword('password');\r\nawait user.save();\r\nconst { user } = await DefaultUser.authenticate()('user', 'password');\r\n```\r\n\r\n### Options\r\n\r\nWhen plugging in Passport-Local Mongoose plugin additional options can be provided to configure\r\nthe hashing algorithm.\r\n\r\n```javascript\r\nUser.plugin(passportLocalMongoose, options);\r\n```\r\n\r\n#### Main Options\r\n\r\n* saltlen: specifies the salt length in bytes. Default: 32\r\n* iterations: specifies the number of iterations used in pbkdf2 hashing algorithm. Default: 25000\r\n* keylen: specifies the length in byte of the generated key. Default: 512\r\n* digestAlgorithm: specifies the pbkdf2 digest algorithm. Default: sha256. (get a list of supported algorithms with crypto.getHashes())\r\n* interval: specifies the interval in milliseconds between login attempts, which increases exponentially based on the number of failed attempts, up to maxInterval. Default: 100\r\n* maxInterval: specifies the maximum amount of time an account can be locked. Default 30000 (5 minutes)\r\n* usernameField: specifies the field name that holds the username. Defaults to 'username'. This option can be used if you want to use a different field to hold the username for example \"email\".\r\n* usernameUnique : specifies if the username field should be enforced to be unique by a mongodb index or not. Defaults to true.\r\n* saltField: specifies the field name that holds the salt value. Defaults to 'salt'.\r\n* hashField: specifies the field name that holds the password hash value. Defaults to 'hash'.\r\n* attemptsField: specifies the field name that holds the number of login failures since the last successful login. Defaults to 'attempts'.\r\n* lastLoginField: specifies the field name that holds the timestamp of the last login attempt. Defaults to 'last'.\r\n* selectFields: specifies the fields of the model to be selected from mongodb (and stored in the session). Defaults to 'undefined' so that all fields of the model are selected.\r\n* usernameLowerCase: convert username field value to lower case when saving an querying. Defaults to 'false'.\r\n* populateFields: specifies fields to populate in findByUsername function. Defaults to 'undefined'.\r\n* encoding: specifies the encoding the generated salt and hash will be stored in. Defaults to 'hex'.\r\n* limitAttempts: specifies whether login attempts should be limited and login failures should be penalized. Default: false.\r\n* maxAttempts: specifies the maximum number of failed attempts allowed before preventing login. Default: Infinity.\r\n* passwordValidator: specifies your custom validation function for the password in the form 'function(password,cb)'. Default: validates non-empty passwords.\r\n* usernameQueryFields: specifies alternative fields of the model for identifying a user (e.g. email).\r\n* findByUsername: Specifies a query function that is executed with query parameters to restrict the query with extra query parameters. For example query only users with field \"active\" set to `true`. Default: `function(model, queryParameters) { return model.findOne(queryParameters); }`. See the examples section for a use case.\r\n\r\n*Attention!* Changing any of the hashing options (saltlen, iterations or keylen) in a production environment will prevent that existing users to authenticate!\r\n\r\n#### Error Messages\r\n\r\nOverride default error messages by setting options.errorMessages.\r\n\r\n* MissingPasswordError  'No password was given'\r\n* AttemptTooSoonError 'Account is currently locked. Try again later'\r\n* TooManyAttemptsError 'Account locked due to too many failed login attempts'\r\n* NoSaltValueStoredError 'Authentication not possible. No salt value stored'\r\n* IncorrectPasswordError 'Password or username are incorrect'\r\n* IncorrectUsernameError 'Password or username are incorrect'\r\n* MissingUsernameError 'No username was given'\r\n* UserExistsError 'A user with the given username is already registered'\r\n\r\n### Hash Algorithm\r\n\r\nPassport-Local Mongoose use the pbkdf2 algorithm of the node crypto library. \r\n[Pbkdf2](http://en.wikipedia.org/wiki/PBKDF2) was chosen because platform independent\r\n(in contrary to bcrypt). For every user a generated salt value is saved to make\r\nrainbow table attacks even harder.\r\n\r\n### Examples\r\n\r\nFor a complete example implementing a registration, login and logout see the \r\n[login example](https://github.com/saintedlama/passport-local-mongoose/tree/master/examples/login).\r\n\r\n## API Documentation\r\n\r\n### Instance methods\r\n\r\n#### setPassword(password, [cb])\r\n\r\nSets a user password. Does not save the user object. If no callback `cb` is provided a `Promise` is returned.\r\n\r\n#### changePassword(oldPassword, newPassword, [cb])\r\n\r\nChanges a user's password hash and salt and saves the user object. If no callback `cb` is provided a `Promise` is returned. If oldPassword does not match the user's old password an `IncorrectPasswordError` is passed to `cb` or the `Promise` is rejected.\r\n\r\n#### authenticate(password, [cb])\r\n\r\nAuthenticate a user object. If no callback `cb` is provided a `Promise` is returned.\r\n\r\n#### resetAttempts([cb])\r\n\r\nReset a user's number of failed password attempts (only defined if `options.limitAttempts` is true) If no callback `cb` is provided a `Promise` is returned.\r\n\r\n### Callback Arguments\r\n\r\n* err\r\n  * null unless the hasing algorithm throws an error\r\n* thisModel\r\n  * the model getting authenticated *if* authentication was successful otherwise false\r\n* passwordErr\r\n  * an instance of `AuthenticationError` describing the reason the password failed, else undefined.\r\n\r\nUsing `setPassword()` will only update the document's password fields, but will not save the document.\r\nTo commit the changed document, remember to use Mongoose's `document.save()` after using `setPassword()`.\r\n\r\n### Error Handling\r\n\r\n* `IncorrectPasswordError`: specifies the error message returned when the password is incorrect. Defaults to 'Incorrect password'.\r\n* `IncorrectUsernameError`: specifies the error message returned when the username is incorrect. Defaults to 'Incorrect username'.\r\n* `MissingUsernameError`: specifies the error message returned when the username has not been set during registration. Defaults to 'Field %s is not set'.\r\n* `MissingPasswordError`: specifies the error message returned when the password has not been set during registration. Defaults to 'Password argument not set!'.\r\n* `UserExistsError`: specifies the error message returned when the user already exists during registration. Defaults to 'User already exists with name %s'.\r\n* `NoSaltValueStored`: Occurs in case no salt value is stored in the MongoDB collection.\r\n* `AttemptTooSoonError`: Occurs if the option `limitAttempts` is set to true and a login attept occures while the user is still penalized.\r\n* `TooManyAttemptsError`: Returned when the user's account is locked due to too many failed login attempts.\r\n\r\nAll those errors inherit from `AuthenticationError`, if you need a more general error class for checking.\r\n\r\n### Static methods\r\n\r\nStatic methods are exposed on the model constructor. For example to use createStrategy function use\r\n\r\n```javascript\r\nconst User = require('./models/user');\r\nUser.createStrategy();\r\n```\r\n\r\n* authenticate() Generates a function that is used in Passport's LocalStrategy\r\n* serializeUser() Generates a function that is used by Passport to serialize users into the session\r\n* deserializeUser() Generates a function that is used by Passport to deserialize users into the session\r\n* register(user, password, cb) Convenience method to register a new user instance with a given password. Checks if username is unique. See [login example](https://github.com/saintedlama/passport-local-mongoose/tree/master/examples/login).\r\n* findByUsername() Convenience method to find a user instance by it's unique username.\r\n* createStrategy() Creates a configured passport-local `LocalStrategy` instance that can be used in passport.\r\n\r\n## Examples\r\n\r\n### Allow only \"active\" users to authenticate\r\n\r\nFirst we define a schema with an additional field `active` of type Boolean. \r\n\r\n```javascript\r\nvar UserSchema = new Schema({\r\n  active: Boolean\r\n});\r\n```\r\n\r\nWhen plugging in Passport-Local Mongoose we set `usernameUnique` to avoid creating a unique mongodb index on field `username`. To avoid\r\nnon active users to be queried by mongodb we can specify the option `findByUsername` that allows us to restrict a query. In our case\r\nwe want to restrict the query to only query users with field `active` set to `true`. The `findByUsername` MUST return a Mongoose query.\r\n\r\n```javascript\r\nUserSchema.plugin(passportLocalMongoose, {\r\n  // Needed to set usernameUnique to true to avoid a mongodb index on the username column!\r\n  usernameUnique: false,\r\n\r\n  findByUsername: function(model, queryParameters) {\r\n    // Add additional query parameter - AND condition - active: true\r\n    queryParameters.active = true;\r\n    return model.findOne(queryParameters);\r\n  }\r\n});\r\n```\r\n\r\nTo test the implementation we can simply create (register) a user with field `active` set to `false` and try to authenticate this user\r\nin a second step:\r\n\r\n```javascript\r\nvar User = mongoose.model('Users', UserSchema);\r\n\r\nUser.register({username:'username', active: false}, 'password', function(err, user) {\r\n  if (err) { ... }\r\n\r\n  var authenticate = User.authenticate();\r\n  authenticate('username', 'password', function(err, result) {\r\n    if (err) { ... }\r\n\r\n    // Value 'result' is set to false. The user could not be authenticated since the user is not active\r\n  });\r\n});\r\n```\r\n\r\n## License\r\n\r\nPassport-Local Mongoose is licenses under the [MIT license](http://opensource.org/licenses/MIT).\r\n",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/saintedlama/passport-local-mongoose.git"
  },
  "scripts": {
    "coveralls": "nyc report --reporter=text-lcov | coveralls",
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "release": "standard-version",
    "test": "cross-env NODE_ENV=test nyc --reporter=text-summary mocha --recursive --throw-deprecation --require babel-polyfill --require babel-core/register"
  },
  "version": "5.0.1"
}
